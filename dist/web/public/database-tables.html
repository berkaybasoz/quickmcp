<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Tables - MCP Server Generator</title>
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        .tab-navigation {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 2rem;
            gap: 0.5rem;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-size: 0.95rem;
            font-weight: 500;
            color: #718096;
            transition: all 0.2s ease;
            border-radius: 8px 8px 0 0;
        }

        .tab-button:hover {
            background: #f7fafc;
            color: #2d3748;
        }

        .tab-button.active {
            color: #3182ce;
            border-bottom-color: #3182ce;
            background: #f7fafc;
            font-weight: 600;
        }

        .tab-content {
            min-height: 400px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .data-table th {
            background: #3182ce;
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.85rem;
            color: #2d3748;
            max-width: 200px;
            word-wrap: break-word;
        }

        .data-table tr:nth-child(even) {
            background: #f7fafc;
        }

        .data-table tr:hover {
            background: #e3f2fd;
        }

        .table-header {
            background: #3182ce;
            color: white;
            padding: 1rem;
            font-weight: 600;
            margin-bottom: 0;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">QM</div>
                <div class="sidebar-title">QuickMCP</div>
            </div>
            <nav class="sidebar-nav">
                <a href="/" class="sidebar-nav-item">
                    <div class="icon">üöÄ</div>
                    <span>Generate Server</span>
                </a>
                <a href="/manage-servers" class="sidebar-nav-item">
                    <div class="icon">üìã</div>
                    <span>Manage Servers</span>
                </a>
                <a href="/test-servers" class="sidebar-nav-item">
                    <div class="icon">üß™</div>
                    <span>Test Servers</span>
                </a>
                <a href="/database-tables" class="sidebar-nav-item active">
                    <div class="icon">üóÉÔ∏è</div>
                    <span>Database Tables</span>
                </a>
                <a href="/how-to-use" class="sidebar-nav-item">
                    <div class="icon">üìñ</div>
                    <span>How to Use</span>
                </a>
            </nav>
        </div>

        <!-- Overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="topbar">
                <button class="hamburger" id="hamburger" onclick="toggleSidebar()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="topbar-title">
                    MCP Server Generator - Database Tables
                </div>
            </div>

            <div class="container">
                <div class="card">
                    <div class="card-header">
                        <h1 class="section-title">SQLite Database Tables</h1>
                        <p class="section-subtitle">Explore the internal database structure</p>
                    </div>
                    <div class="card-content">
                        <div id="loading" class="loading">Loading database tables...</div>
                        <div id="content" style="display: none;">
                            <!-- Tab Navigation -->
                            <div class="tab-navigation">
                                <button class="tab-button active" onclick="showTab('servers')">
                                    üñ•Ô∏è Servers (<span id="servers-count">0</span>)
                                </button>
                                <button class="tab-button" onclick="showTab('tools')">
                                    üîß Tools (<span id="tools-count">0</span>)
                                </button>
                                <button class="tab-button" onclick="showTab('resources')">
                                    üì¶ Resources (<span id="resources-count">0</span>)
                                </button>
                            </div>

                            <!-- Tab Content -->
                            <div class="tab-content">
                                <div id="servers" class="tab-panel active">
                                    <h3 class="table-header">üñ•Ô∏è Servers</h3>
                                    <div id="servers-table"></div>
                                </div>
                                <div id="tools" class="tab-panel">
                                    <h3 class="table-header">üîß Tools</h3>
                                    <div id="tools-table"></div>
                                </div>
                                <div id="resources" class="tab-panel">
                                    <h3 class="table-header">üì¶ Resources</h3>
                                    <div id="resources-table"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="shared.js"></script>
    <script>
        let tablesData = {};

        // Load tables when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadTables();
        });

        async function loadTables() {
            try {
                const response = await fetch('/api/database/tables');
                const result = await response.json();

                if (result.success) {
                    // Store data
                    result.data.tables.forEach(table => {
                        tablesData[table.name] = table;
                    });

                    // Update counts
                    document.getElementById('servers-count').textContent = tablesData.servers ? tablesData.servers.rowCount : 0;
                    document.getElementById('tools-count').textContent = tablesData.tools ? tablesData.tools.rowCount : 0;
                    document.getElementById('resources-count').textContent = tablesData.resources ? tablesData.resources.rowCount : 0;

                    // Show content
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';

                    // Load first tab
                    showTab('servers');
                } else {
                    document.getElementById('loading').innerHTML = 'Error loading tables: ' + result.error;
                }
            } catch (error) {
                document.getElementById('loading').innerHTML = 'Error: ' + error.message;
            }
        }

        function showTab(tableName) {
            // Update buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update panels
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(tableName).classList.add('active');

            // Load table data
            const table = tablesData[tableName];
            if (table) {
                const tableContainer = document.getElementById(tableName + '-table');
                tableContainer.innerHTML = generateTable(table);
            }
        }

        function generateTable(table) {
            if (!table.sampleData || table.sampleData.length === 0) {
                return '<p>No data available</p>';
            }

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            ${table.columns.map(col => `<th>${col.name}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
            `;

            table.sampleData.forEach(row => {
                html += '<tr>';
                table.columns.forEach(col => {
                    let value = row[col.name];
                    if (value === null || value === undefined) {
                        value = '<em>NULL</em>';
                    } else if (typeof value === 'string' && value.length > 100) {
                        value = value.substring(0, 100) + '...';
                    }
                    html += `<td>${value}</td>`;
                });
                html += '</tr>';
            });

            html += `
                    </tbody>
                </table>
                <p style="text-align: center; color: #718096; margin-top: 1rem;">
                    Showing ${table.sampleData.length} of ${table.rowCount} rows
                </p>
            `;

            return html;
        }
    </script>
</body>
</html>