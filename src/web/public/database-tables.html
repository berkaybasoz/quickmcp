<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Tables - QuickMCP</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Custom Archdraw Styles -->
    <link rel="stylesheet" href="quickmcp-styles.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for data tables */
        .data-table th {
            background-color: #f1f5f9;
            color: #475569;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
            color: #334155;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover td {
            background-color: #f8fafc;
        }
    </style>
</head>

<body class="h-screen flex flex-col bg-gradient-to-br from-slate-50 to-slate-100 overflow-hidden text-slate-900">

    <!-- Header -->
    <header
        class="backdrop-blur-sm bg-white/80 border-b border-slate-200/60 shadow-sm relative z-50 h-16 flex-shrink-0 flex items-center justify-between px-6 py-3">
        <!-- Brand -->
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <div
                    class="w-9 h-9 rounded-lg bg-blue-600 text-white flex items-center justify-center shadow-lg shadow-blue-500/25">
                    <i class="fas fa-rocket text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold gradient-text leading-tight">QuickMCP</h1>
                    <p class="text-xs text-slate-500 font-medium">Server Generator</p>
                </div>
            </div>
            <div class="h-8 w-px bg-gradient-to-b from-transparent via-slate-300 to-transparent hidden md:block"></div>
            <div class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-600">
                <span>Database Tables</span>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-3">
            <div
                class="hidden sm:flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1.5 rounded-lg text-sm font-medium border border-green-200/50">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span>System Online</span>
            </div>
            <button
                class="p-2 rounded-lg hover:bg-slate-100 transition-colors relative text-slate-500 hover:text-slate-700">
                <i class="fas fa-bell"></i>
                <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
            </button>
            <div
                class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 text-white flex items-center justify-center text-sm font-bold shadow-md" data-user-avatar>
                G
            </div>
        </div>
    </header>

    <!-- Main Body -->
    <div class="flex flex-1 overflow-hidden">

        <!-- Left Sidebar (Navigation) -->
        <div class="w-72 bg-white/95 backdrop-blur-sm border-r border-slate-200/60 flex flex-col flex-shrink-0 z-40">
            <!-- Sidebar Header -->
            <div class="p-6 border-b border-slate-200/60 bg-gradient-to-r from-slate-50/50 to-white/50">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 flex items-center justify-center bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg shadow-lg shadow-emerald-500/25">
                            <i class="fas fa-compass text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-slate-900 font-bold tracking-tight text-lg">Navigation</h2>
                            <p class="text-slate-500 text-xs leading-none font-medium">Application Pages</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="p-4 overflow-y-auto flex-1 scrollbar-modern space-y-3">

                <a href="/"
                    class="card card-hover group relative flex items-center gap-3 p-4 hover:border-blue-300 hover:shadow-blue-500/10 transition-all">
                    <div class="relative">
                        <div
                            class="p-2.5 rounded-lg shadow-sm bg-slate-100 text-slate-600 group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors">
                            <i class="fas fa-magic"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <span
                            class="text-slate-700 font-semibold text-sm block group-hover:text-blue-700 transition-colors">Generate
                            Server</span>
                    </div>
                </a>

                <a href="/manage-servers"
                    class="card card-hover group relative flex items-center gap-3 p-4 hover:border-blue-300 hover:shadow-blue-500/10 transition-all">
                    <div class="relative">
                        <div
                            class="p-2.5 rounded-lg shadow-sm bg-slate-100 text-slate-600 group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors">
                            <i class="fas fa-server"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <span
                            class="text-slate-700 font-semibold text-sm block group-hover:text-blue-700 transition-colors">Manage
                            Servers</span>
                    </div>
                </a>

                <a href="/test-servers"
                    class="card card-hover group relative flex items-center gap-3 p-4 hover:border-blue-300 hover:shadow-blue-500/10 transition-all">
                    <div class="relative">
                        <div
                            class="p-2.5 rounded-lg shadow-sm bg-slate-100 text-slate-600 group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors">
                            <i class="fas fa-vial"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <span
                            class="text-slate-700 font-semibold text-sm block group-hover:text-blue-700 transition-colors">Test
                            Servers</span>
                    </div>
                </a>

                <!-- Active Link -->
                <a href="/database-tables"
                    class="card relative flex items-center gap-3 p-4 border-blue-400 shadow-md shadow-blue-500/10 bg-blue-50/30">
                    <div class="relative">
                        <div class="p-2.5 rounded-lg shadow-sm bg-blue-500 text-white">
                            <i class="fas fa-table"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <span class="text-blue-900 font-bold text-sm block">Database Tables</span>
                        <span class="text-blue-600 text-xs mt-0.5 block font-medium">Inspect Data</span>
                    </div>
                    <div class="w-1.5 h-1.5 rounded-full bg-blue-500 shadow-sm"></div>
                </a>

                <a href="/how-to-use"
                    class="card card-hover group relative flex items-center gap-3 p-4 hover:border-blue-300 hover:shadow-blue-500/10 transition-all">
                    <div class="relative">
                        <div
                            class="p-2.5 rounded-lg shadow-sm bg-slate-100 text-slate-600 group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors">
                            <i class="fas fa-book"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <span
                            class="text-slate-700 font-semibold text-sm block group-hover:text-blue-700 transition-colors">How
                            to Use</span>
                    </div>
                </a>

            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 relative bg-slate-50/50 overflow-hidden flex flex-col min-w-0">
            <div class="absolute inset-0 shadow-inner shadow-slate-200/30 pointer-events-none z-10"></div>

            <div class="flex-1 overflow-y-auto scrollbar-modern p-8 relative z-0">
                <div class="max-w-7xl mx-auto space-y-8 pb-20">

                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold text-slate-900">SQLite Database Tables</h2>
                            <p class="text-slate-600 mt-1">Explore the internal database structure</p>
                        </div>
                        <button onclick="loadTables()"
                            class="bg-white border border-slate-200 hover:border-blue-400 text-slate-700 hover:text-blue-600 px-4 py-2 rounded-lg font-medium transition-colors shadow-sm flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center gap-4 mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200">
                            <div class="p-3 bg-blue-100 text-blue-600 rounded-lg">
                                <i class="fas fa-database text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-slate-900 uppercase tracking-wide">Database Path</h3>
                                <p class="text-xs font-mono text-slate-600 mt-1 break-all" id="dbPath">Loading...</p>
                            </div>
                            <div class="ml-auto text-right">
                                <h3 class="text-sm font-bold text-slate-900 uppercase tracking-wide">Total Tables</h3>
                                <p class="text-2xl font-bold text-blue-600 leading-none mt-1" id="tableCount">-</p>
                            </div>
                        </div>

                        <div id="tables-container">
                            <div id="tablesLoading" class="text-center py-12">
                                <div
                                    class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3">
                                </div>
                                <p class="text-sm font-medium text-blue-600">Loading database tables...</p>
                            </div>

                            <div id="tables-tabs" style="display: none;">
                                <!-- Tabs -->
                                <div class="flex border-b border-slate-200 mb-6">
                                    <button
                                        class="px-6 py-3 text-sm font-bold text-blue-600 border-b-2 border-blue-600 bg-blue-50/50 rounded-t-lg transition-colors tab-button active"
                                        data-table="servers" onclick="switchTab('servers')">
                                        <i class="fas fa-server mr-2"></i> Servers (<span id="servers-count">0</span>)
                                    </button>
                                    <button
                                        class="px-6 py-3 text-sm font-medium text-slate-600 hover:text-slate-900 border-b-2 border-transparent hover:bg-slate-50 rounded-t-lg transition-colors tab-button"
                                        data-table="tools" onclick="switchTab('tools')">
                                        <i class="fas fa-wrench mr-2"></i> Tools (<span id="tools-count">0</span>)
                                    </button>
                                    <button
                                        class="px-6 py-3 text-sm font-medium text-slate-600 hover:text-slate-900 border-b-2 border-transparent hover:bg-slate-50 rounded-t-lg transition-colors tab-button"
                                        data-table="resources" onclick="switchTab('resources')">
                                        <i class="fas fa-box mr-2"></i> Resources (<span id="resources-count">0</span>)
                                    </button>
                                </div>

                                <!-- Content -->
                                <div class="tab-content">
                                    <div id="tab-servers" class="tab-panel active"></div>
                                    <div id="tab-tools" class="tab-panel hidden"></div>
                                    <div id="tab-resources" class="tab-panel hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Table Details Modal -->
    <div id="tableDetailsModal"
        class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden">
            <div class="p-6 border-b border-slate-200 flex justify-between items-center bg-slate-50">
                <h2 class="text-xl font-bold text-slate-900" id="tableModalTitle">Table Details</h2>
                <button onclick="closeTableDetailsModal()"
                    class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto" id="tableModalBody">
                <div class="text-center py-8">Loading...</div>
            </div>
        </div>
    </div>

    <script src="shared.js"></script>
    <script>
        // Load tables when page loads
        document.addEventListener('DOMContentLoaded', function () {
            loadTables();
        });

        async function loadTables() {
            const loading = document.getElementById('tablesLoading');
            const tabsContainer = document.getElementById('tables-tabs');

            loading.style.display = 'block';
            tabsContainer.style.display = 'none';

            try {
                const response = await fetch('/api/database/tables');
                const result = await response.json();

                if (result.success) {
                    displayTables(result.data.tables);
                    updateDatabaseInfo(result.data);
                } else {
                    throw new Error(result.error || 'Failed to load tables');
                }
            } catch (error) {
                console.error('Error loading tables:', error);
                tabsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-red-500 text-4xl mb-4"><i class="fas fa-exclamation-circle"></i></div>
                        <h3 class="text-lg font-bold text-slate-900">Failed to Load Tables</h3>
                        <p class="text-slate-600 mb-4">Error: ${error.message}</p>
                        <button class="bg-blue-600 text-white px-4 py-2 rounded-lg" onclick="loadTables()">Retry</button>
                    </div>
                `;
                tabsContainer.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        }

        function updateDatabaseInfo(data) {
            document.getElementById('dbPath').textContent = data.dbPath || 'Unknown';
            document.getElementById('tableCount').textContent = data.tables.length;
        }

        function displayTables(tables) {
            const tabsContainer = document.getElementById('tables-tabs');

            if (tables.length === 0) {
                tabsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-slate-300 text-4xl mb-4"><i class="fas fa-table"></i></div>
                        <h3 class="text-lg font-bold text-slate-900">No Tables Found</h3>
                        <p class="text-slate-600">The database appears to be empty.</p>
                    </div>
                `;
                return;
            }

            tables.forEach(table => {
                const countSpan = document.getElementById(`${table.name}-count`);
                if (countSpan) countSpan.textContent = table.rowCount || 0;
            });

            tables.forEach(table => {
                const tabPanel = document.getElementById(`tab-${table.name}`);
                if (tabPanel) tabPanel.innerHTML = generateTableHTML(table);
            });

            tabsContainer.style.display = 'block';
        }

        function generateTableHTML(table) {
            if (!table.sampleData || table.sampleData.length === 0) {
                return `
                    <div class="text-center py-12 bg-slate-50 rounded-xl border border-slate-200 border-dashed">
                        <p class="text-slate-500 italic">No data available in ${table.name}</p>
                    </div>
                `;
            }

            return `
                <div class="border border-slate-200 rounded-xl overflow-hidden">
                    <div class="bg-slate-50 px-4 py-3 border-b border-slate-200 flex justify-between items-center">
                        <span class="font-bold text-slate-700 text-sm uppercase">${table.name}</span>
                        <span class="text-xs text-slate-500">${table.rowCount} rows</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full data-table">
                            <thead>
                                <tr>
                                    ${table.columns.map(col => `<th>${col.name}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${table.sampleData.map(row => `
                                    <tr>
                                        ${table.columns.map(col => `
                                            <td>${row[col.name] !== null && row[col.name] !== undefined ?
                    (typeof row[col.name] === 'string' && row[col.name].length > 100 ?
                        row[col.name].substring(0, 100) + '...' :
                        row[col.name]) : '<em class="text-slate-400">NULL</em>'}</td>
                                        `).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${table.sampleData.length >= 5 ? `
                        <div class="bg-slate-50 px-4 py-2 border-t border-slate-200 text-center text-xs text-slate-500">
                            Showing first ${table.sampleData.length} rows
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function switchTab(tableName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50/50');
                btn.classList.add('text-slate-600', 'border-transparent');
            });
            const activeBtn = document.querySelector(`[data-table="${tableName}"]`);
            activeBtn.classList.add('active', 'text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50/50');
            activeBtn.classList.remove('text-slate-600', 'border-transparent');

            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.add('hidden'));
            document.getElementById(`tab-${tableName}`).classList.remove('hidden');
        }

        function closeTableDetailsModal() {
            document.getElementById('tableDetailsModal').classList.add('hidden');
        }
    </script>
</body>

</html>
